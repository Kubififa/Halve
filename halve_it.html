<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halve It Skóre</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
        }
        h1, h2, h3 {
            color: #007aff;
            text-align: center;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .dart-inputs input[type="number"] {
            width: calc(33% - 10px);
            margin-right: 5px;
            display: inline-block;
        }
        .dart-inputs input[type="number"]:last-child {
            margin-right: 0;
        }

        /* Styly pro tlačítka násobitelů */
        .detailed-segment-inputs-area .dart-row {
            margin-bottom: 15px;
        }
        .detailed-segment-inputs-area .dart-label {
            font-weight: normal;
            margin-bottom: 5px;
        }
        .multiplier-buttons button {
            padding: 8px 12px;
            margin-right: 5px;
            border: 1px solid #007aff;
            background-color: #f8f8f8;
            color: #007aff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            min-width: 50px; /* Zajistí podobnou šířku */
            text-align: center;
        }
        .multiplier-buttons button:last-child {
            margin-right: 0;
        }
        .multiplier-buttons button.active {
            background-color: #007aff;
            color: white;
            font-weight: bold;
        }
         .multiplier-buttons button:hover:not(.active) {
            background-color: #e0e0e0;
        }


        button#submit-turn, button#start-game, button#restart-game { /* Hlavní tlačítka */
            background-color: #007aff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            width: 100%;
        }
        button#submit-turn:hover, button#start-game:hover, button#restart-game:hover {
            background-color: #005ecb;
        }

        #scoreboard { margin-top: 20px; }
        #scoreboard table { width: 100%; border-collapse: collapse; }
        #scoreboard th, #scoreboard td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #scoreboard th { background-color: #f2f2f2; }
        .hidden { display: none; }
        .current-player-highlight td:first-child { font-weight: bold; background-color: #e0ffe0; }
        #game-over-message { text-align: center; font-size: 1.2em; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Halve It Skóre</h1>

        <div id="setup-area">
            <h2>Nastavení hry</h2>
            <label for="num-players">Počet hráčů (1-8):</label>
            <input type="number" id="num-players" min="1" max="8" value="2">
            <div id="player-names-area"></div>
            <button id="start-game">Začít hru</button>
        </div>

        <div id="game-area" class="hidden">
            <h2 id="current-target-display">Cíl</h2>
            <h3 id="current-player-display">Hráč</h3>

            <div id="inputs-area">
                <p id="input-prompt"></p>
                
                <div id="segment-simple-hits-area" class="hidden">
                    <label for="hits-count">Počet zásahů (0-3):</label>
                    <input type="number" id="hits-count" min="0" max="3" value="0">
                </div>

                <div id="detailed-segment-inputs-area" class="hidden">
                    <!-- Šipka 1 -->
                    <div class="dart-row" id="dart1-row">
                        <div class="dart-label">Šipka 1 (na cíl):</div>
                        <div class="multiplier-buttons">
                            <button data-dart="1" data-multiplier="0">Miss</button>
                            <button data-dart="1" data-multiplier="1">S</button>
                            <button data-dart="1" data-multiplier="2">D</button>
                            <button data-dart="1" data-multiplier="3">T</button>
                        </div>
                    </div>
                    <!-- Šipka 2 -->
                    <div class="dart-row" id="dart2-row">
                        <div class="dart-label">Šipka 2 (na cíl):</div>
                        <div class="multiplier-buttons">
                            <button data-dart="2" data-multiplier="0">Miss</button>
                            <button data-dart="2" data-multiplier="1">S</button>
                            <button data-dart="2" data-multiplier="2">D</button>
                            <button data-dart="2" data-multiplier="3">T</button>
                        </div>
                    </div>
                    <!-- Šipka 3 -->
                    <div class="dart-row" id="dart3-row">
                        <div class="dart-label">Šipka 3 (na cíl):</div>
                        <div class="multiplier-buttons">
                            <button data-dart="3" data-multiplier="0">Miss</button>
                            <button data-dart="3" data-multiplier="1">S</button>
                            <button data-dart="3" data-multiplier="2">D</button>
                            <button data-dart="3" data-multiplier="3">T</button>
                        </div>
                    </div>
                </div>

                <div id="any-multiple-inputs-area" class="dart-inputs hidden">
                    <label>Hodnoty trefených čísel (0 pro miss/jiný typ):</label>
                    <input type="number" id="dart1-value" min="0" max="20">
                    <input type="number" id="dart2-value" min="0" max="20">
                    <input type="number" id="dart3-value" min="0" max="20">
                </div>
            </div>
            <button id="submit-turn">Potvrdit kolo</button>

            <div id="scoreboard">
                <h2>Aktuální skóre</h2>
                <table id="scores-table">
                    <thead><tr><th>Hráč</th><th>Skóre</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div id="game-over-area" class="hidden">
            <h2>Konec hry!</h2>
            <div id="game-over-message"></div>
            <table id="final-scores-table">
                <thead><tr><th>Hráč</th><th>Finální skóre</th></tr></thead>
                <tbody></tbody>
            </table>
            <button id="restart-game">Nová hra</button>
        </div>
    </div>

    <script>
        const targets = [
            { id: "s20", name: "20", type: "segment_detailed", value: 20, prompt: "Zadej zásahy pro 20 (každá šipka):" },
            { id: "s19", name: "19", type: "segment_detailed", value: 19, prompt: "Zadej zásahy pro 19 (každá šipka):" },
            { id: "anyT", name: "Jakýkoliv Triple", type: "any_multiple", multiplier: 3, prompt: "Zadej základní hodnoty hozených triplů (1-20, 0 pro miss/jiný typ):" },
            { id: "s18", name: "18", type: "segment_detailed", value: 18, prompt: "Zadej zásahy pro 18 (každá šipka):" },
            { id: "s17", name: "17", type: "segment_detailed", value: 17, prompt: "Zadej zásahy pro 17 (každá šipka):" },
            { id: "anyD", name: "Jakýkoliv Double", type: "any_multiple", multiplier: 2, prompt: "Zadej základní hodnoty hozených doublů (1-20, 0 pro miss/jiný typ):" },
            { id: "s16", name: "16", type: "segment_detailed", value: 16, prompt: "Zadej zásahy pro 16 (každá šipka):" },
            { id: "s15", name: "15", type: "segment_detailed", value: 15, prompt: "Zadej zásahy pro 15 (každá šipka):" },
            { id: "bull", name: "Prostředek (Bull)", type: "segment_simple_hits", value: 50, prompt: "Počet zásahů Bullu (0-3, každý za 50b):" }
        ];

        let players = [];
        let currentPlayerIndex = 0;
        let currentTargetIndex = 0;
        const initialScore = 0;

        // ... (DOM elementy zůstávají stejné, jen přibudou odkazy na nové prvky)
        const setupArea = document.getElementById('setup-area');
        const gameArea = document.getElementById('game-area');
        const gameOverArea = document.getElementById('game-over-area');
        const numPlayersInput = document.getElementById('num-players');
        const playerNamesArea = document.getElementById('player-names-area');
        const startGameButton = document.getElementById('start-game');
        
        const currentTargetDisplay = document.getElementById('current-target-display');
        const currentPlayerDisplay = document.getElementById('current-player-display');
        const inputPrompt = document.getElementById('input-prompt');

        const segmentSimpleHitsArea = document.getElementById('segment-simple-hits-area');
        const hitsCountInput = document.getElementById('hits-count');

        const detailedSegmentInputsArea = document.getElementById('detailed-segment-inputs-area');
        // Pro ukládání zvolených násobitelů pro každou šipku
        let dartMultipliers = { 1: 0, 2: 0, 3: 0 }; 

        const anyMultipleInputsArea = document.getElementById('any-multiple-inputs-area');
        const dartValueInputs = [
            document.getElementById('dart1-value'),
            document.getElementById('dart2-value'),
            document.getElementById('dart3-value')
        ];

        const submitTurnButton = document.getElementById('submit-turn');
        const scoresTableBody = document.getElementById('scores-table').getElementsByTagName('tbody')[0];
        const finalScoresTableBody = document.getElementById('final-scores-table').getElementsByTagName('tbody')[0];
        const gameOverMessage = document.getElementById('game-over-message');
        const restartGameButton = document.getElementById('restart-game');

        // Event listener pro tlačítka násobitelů
        detailedSegmentInputsArea.querySelectorAll('.multiplier-buttons button').forEach(button => {
            button.addEventListener('click', (event) => {
                const dartNum = event.target.dataset.dart;
                const multiplier = parseInt(event.target.dataset.multiplier);
                
                // Uložit zvolený násobitel
                dartMultipliers[dartNum] = multiplier;

                // Odstranit 'active' třídu ze všech tlačítek pro danou šipku
                detailedSegmentInputsArea.querySelectorAll(`.multiplier-buttons button[data-dart="${dartNum}"]`).forEach(btn => {
                    btn.classList.remove('active');
                });
                // Přidat 'active' třídu na kliknuté tlačítko
                event.target.classList.add('active');
            });
        });


        numPlayersInput.addEventListener('input', updatePlayerNameInputs);
        // ... (updatePlayerNameInputs a startGameButton zůstávají stejné)

        function updatePlayerNameInputs() {
            const num = parseInt(numPlayersInput.value) || 0;
            playerNamesArea.innerHTML = '';
            for (let i = 0; i < num; i++) {
                const label = document.createElement('label');
                label.setAttribute('for', `player-name-${i}`);
                label.textContent = `Jméno hráče ${i + 1}:`;
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `player-name-${i}`;
                input.value = `Hráč ${i + 1}`;
                playerNamesArea.appendChild(label);
                playerNamesArea.appendChild(input);
            }
        }
        
        startGameButton.addEventListener('click', () => {
            const num = parseInt(numPlayersInput.value);
            if (num < 1 || num > 8) {
                alert("Prosím zadejte platný počet hráčů (1-8).");
                return;
            }
            players = [];
            for (let i = 0; i < num; i++) {
                const nameInput = document.getElementById(`player-name-${i}`);
                players.push({ name: nameInput ? nameInput.value : `Hráč ${i + 1}`, score: initialScore });
            }
            currentPlayerIndex = 0;
            currentTargetIndex = 0;
            setupArea.classList.add('hidden');
            gameOverArea.classList.add('hidden');
            gameArea.classList.remove('hidden');
            updateScoreboard();
            displayTurn();
        });
        
        submitTurnButton.addEventListener('click', () => {
            const currentTarget = targets[currentTargetIndex];
            let roundScore = 0;
            let totalHitsThisRound = 0;

            if (currentTarget.type === "segment_simple_hits") {
                const hits = parseInt(hitsCountInput.value);
                if (hits >= 0 && hits <= 3) {
                    roundScore = hits * currentTarget.value;
                    totalHitsThisRound = hits;
                } else {
                    alert("Neplatný počet zásahů.");
                    return;
                }
            } else if (currentTarget.type === "segment_detailed") {
                // Čtení hodnot z aktivních tlačítek (uložených v dartMultipliers)
                for (const dartNum in dartMultipliers) {
                    const multiplier = dartMultipliers[dartNum];
                    if (multiplier > 0) { // 0 = Miss
                        roundScore += multiplier * currentTarget.value;
                        totalHitsThisRound++;
                    }
                }
            } else if (currentTarget.type === "any_multiple") {
                let validInputValues = true;
                dartValueInputs.forEach(input => {
                    const val = parseInt(input.value);
                    if (isNaN(val) || val < 0 || val > 20) { 
                        if (val !== 0) validInputValues = false;
                    }
                    if (val > 0) {
                        roundScore += val * currentTarget.multiplier;
                        totalHitsThisRound++;
                    }
                });
                if (!validInputValues) {
                    alert("Neplatná hodnota pro šipku (0-20).");
                    return;
                }
            }

            if (totalHitsThisRound === 0) {
                players[currentPlayerIndex].score = Math.floor(players[currentPlayerIndex].score / 2);
            } else {
                players[currentPlayerIndex].score += roundScore;
            }

            currentPlayerIndex++;
            if (currentPlayerIndex >= players.length) {
                currentPlayerIndex = 0;
                currentTargetIndex++;
            }

            updateScoreboard();

            if (currentTargetIndex >= targets.length) {
                endGame();
            } else {
                displayTurn();
            }
        });

        restartGameButton.addEventListener('click', () => {
            gameOverArea.classList.add('hidden');
            setupArea.classList.remove('hidden');
            updatePlayerNameInputs(); 
        });

        function displayTurn() {
            const currentTarget = targets[currentTargetIndex];
            const currentPlayer = players[currentPlayerIndex];

            currentTargetDisplay.textContent = `Cíl: ${currentTarget.name}`;
            currentPlayerDisplay.textContent = `Na řadě: ${currentPlayer.name}`;
            inputPrompt.textContent = currentTarget.prompt;

            segmentSimpleHitsArea.classList.add('hidden');
            detailedSegmentInputsArea.classList.add('hidden');
            anyMultipleInputsArea.classList.add('hidden');

            if (currentTarget.type === "segment_simple_hits") {
                segmentSimpleHitsArea.classList.remove('hidden');
                hitsCountInput.value = "0";
                hitsCountInput.focus();
            } else if (currentTarget.type === "segment_detailed") {
                detailedSegmentInputsArea.classList.remove('hidden');
                // Resetovat aktivní tlačítka a uložené hodnoty násobitelů na Miss (0)
                dartMultipliers = { 1: 0, 2: 0, 3: 0 };
                detailedSegmentInputsArea.querySelectorAll('.multiplier-buttons button').forEach(btn => {
                    btn.classList.remove('active');
                    // Nastavit 'Miss' (multiplier 0) jako výchozí aktivní pro každou šipku
                    if (parseInt(btn.dataset.multiplier) === 0) {
                        btn.classList.add('active');
                    }
                });
                // Focus není na tlačítka tak přímočarý, uživatel bude muset kliknout
            } else if (currentTarget.type === "any_multiple") {
                anyMultipleInputsArea.classList.remove('hidden');
                dartValueInputs.forEach(input => input.value = "0");
                dartValueInputs[0].focus();
            }
        }
        
        // ... (updateScoreboard a endGame zůstávají stejné)
        function updateScoreboard() {
            scoresTableBody.innerHTML = '';
            players.forEach((player, index) => {
                const row = scoresTableBody.insertRow();
                if (index === currentPlayerIndex && currentTargetIndex < targets.length) {
                    row.classList.add('current-player-highlight');
                }
                const cellName = row.insertCell();
                const cellScore = row.insertCell();
                cellName.textContent = player.name;
                cellScore.textContent = player.score;
            });
        }

        function endGame() {
            gameArea.classList.add('hidden');
            gameOverArea.classList.remove('hidden');

            players.sort((a, b) => b.score - a.score); 

            let winnerText = `Vítěz je ${players[0].name} s ${players[0].score} body!`;
            if (players.length > 1 && players[0].score === players[1].score) {
                const winners = players.filter(p => p.score === players[0].score);
                if (winners.length > 1) {
                    winnerText = `Remíza mezi: ${winners.map(w => w.name).join(', ')} s ${players[0].score} body!`;
                }
            }
            gameOverMessage.textContent = winnerText;
            
            finalScoresTableBody.innerHTML = '';
            players.forEach(player => {
                const row = finalScoresTableBody.insertRow();
                const cellName = row.insertCell();
                const cellScore = row.insertCell();
                cellName.textContent = player.name;
                cellScore.textContent = player.score;
            });
        }

        updatePlayerNameInputs();
        numPlayersInput.focus();
    </script>
</body>
</html>